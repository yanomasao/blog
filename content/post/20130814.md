---
title: "ゲストOSのディスク容量を増やす"
date: 2013-08-14T09:00:00+09:00
draft: false
---
ディスク容量100Gで気楽に作ったゲストOSをそのまま運用で使うことになり、500Gへ増やすことにした。

ゲストOS停止
バックアップ
```
qemu-img resize aplivevm +400G
```
これだけだと、ホストからみた容量は増えたが、ゲストからするとあいかわらず100Gのまま。使用量が100Gを超えるとパンクする。

そこで、ゲストを起動し、
```
# shutdown now
```
でシングルユーザモードへ移行。virt-managerのコンソールにシングルユーザモードのシェルがでるので、
```
# fdisk /dev/vda
```
を使うが、ルートパーティションはそのままにして、別のパーティションを追加（/dev/vda3）する。OSを再起動させ、
```
# mkfs.ext4 /dev/vda3
```
としたところで、なぜかゲストOS死亡。ためしに
```
# mkfs.ext3 /dev/vda3
```
はできた。その後
```
# mkfs.ext4 -j /dev/vda3
```
もできたのでよしとする。

