<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" Posts &middot;  コードの波にゆ～らゆら" />
  
  <meta property="og:site_name" content="コードの波にゆ～らゆら" />
  <meta property="og:url" content="https://ymraintree.github.io/blog/post/" />
  
  
  <meta property="og:type" content="website" />
  

  <title>
     Posts &middot;  コードの波にゆ～らゆら
  </title>

  <link rel="stylesheet" href="https://ymraintree.github.io/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://ymraintree.github.io/blog/css/main.css" />
  <link rel="stylesheet" href="https://ymraintree.github.io/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://ymraintree.github.io/blog/css/github.css" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400" type="text/css">
  <link rel="shortcut icon" href="https://ymraintree.github.io/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://ymraintree.github.io/blog/images/apple-touch-icon.png" />
  
</head>
<body>
    <header class="global-header"  style="background-image:url( /images/bg.jpg )">
    <section class="header-text">
      <h1><a href="https://ymraintree.github.io/blog/">コードの波にゆ～らゆら</a></h1>
      
      <div class="sns-links hidden-print">
  
  
  
  
  
  
  
  
  
  
  
  
</div>

      
      <a href="https://ymraintree.github.io/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
      
      <a href="https://ymraintree.github.io/blog/post/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
      
    </section>
  </header>
  <main class="container">

<section class="article-list">
  <h1>Posts</h1>
  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2020/20200227/"></a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2020-02-20T09:00:00&#43;09:00">
          Feb 20, 2020
        </time>
      </div>
    </div>
  </header>
  <div>
    <h1 id="windowsでtail">Windowsでtail</h1>
<p>最近windowsサーバを使うことが多くなり、tomcatのログを流しながら作業したくて、調べた。power shellで以下を実行。</p>
<blockquote>
<p>get-content -path ファイル名 -wait</p>
</blockquote>
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190509/">Dockerでsambaサーバ作成</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-05-10T09:04:01&#43;09:00">
          May 10, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>vmware上のsambaサーバをDockerコンテナ化。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190509/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190506/">ラ・フォル・ジュルネ 2019</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-05-06T10:24:20&#43;09:00">
          May 6, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>10連休の今年のGW、例年と変わらずなにもせずに終わりつつありますが、唯一のイベントとして、東京国際フォーラムのラ・フォル・ジュルネに行ってきました。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190506/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190420/">Karabiner-Elements</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-04-21T01:32:41&#43;09:00">
          Apr 21, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>Macのコマンドキーとコントロールキーを入れ替えるのにkeyhacを使っていたけれど、</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190420/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190418/">ソフトウェアデザイン 2019年4月号</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-04-18T14:53:32&#43;09:00">
          Apr 18, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>もう5月号が出ているけれど、ようやく目を通した。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190418/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190404/">スマホでブログを書いてみる</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-04-04T09:00:00&#43;09:00">
          Apr 4, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>スマホでブログを書いてみる。<code>hugo new</code>せずにgithubでcreate new file
するので、</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190404/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190331-3/">『月の満ち欠け』佐藤正午</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-31T12:30:00&#43;09:00">
          Mar 31, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>突然ですが、ここで書籍のおはなし。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190331-3/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190331-2/">次はカテゴリとかタグかな</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-31T01:40:00&#43;09:00">
          Mar 31, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    TODO: やっぱりカテゴリとかタグとか必要ですよね。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190330-3/">CircleCI --&gt; Slackへの通知</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-31T00:44:00&#43;09:00">
          Mar 31, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    こちらのページを参考に、サクッとSlack連携。ありがとうございました。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190331/">テスト</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-31T00:14:13&#43;09:00">
          Mar 31, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    githubで直接書いてもいいのね。プレビューもできるし。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190330-2/">BOSE SoundSport Free購入</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-30T17:09:13&#43;09:00">
          Mar 30, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    いつもBOSEのQuiet Comfort 35 IIを使っているが、Amazonで安かった＆LINE PAYで20％オフということで、SoundSport Freeも購入。自宅で使っている限り、とても快適。これでリモートの打ち合わせももっと楽になるかも。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190330/">CircleCI</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-30T09:48:11&#43;09:00">
          Mar 30, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    このブログをCircleCIで自動化。しかし、config.ymlを変更したりしてもCircleCIが走ってしまうのはどうすればいいのか。commit -m '[ci skip]'しても走ってしまう。ちょっと気持ち悪い。
そうか、CI/CDされたくなければgithub上で直接編集すればいいのか。ローカルでテストできるものでもないし。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/template/"></a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-30T09:00:00&#43;09:00">
          Mar 30, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190329-3/">github pages&#43;hugoでblog その３ CircleCI</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-29T23:57:35&#43;09:00">
          Mar 29, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>ついでなので、CircleCIでビルド＆公開の設定。どうやら、.circleci/config.ymlにgithubに変化があったときに何をするかを定義していくらしい。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190329-3/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190329-2/">github pages&#43;hugoでblog その２</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-29T10:00:00&#43;09:00">
          Mar 29, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>前回は公開用とコンテンツ作成用でリポジトリをふたつに分けたが、やっぱりリポジトリはひとつのほうがシンプルでいいので、その方式で再作成。githubのリポジトリはblogとする。</p>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190329-2/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190329/">github pages&#43;hugoでblog</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-29T09:00:00&#43;09:00">
          Mar 29, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    <p>github.comにリポジトリを作成しておく。</p>
<table>
<thead>
<tr>
<th>　　　</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ymraintree.github.io</td>
<td>公開コンテンツ用</td>
</tr>
<tr>
<td>ymraintree.github.io.hugo   </td>
<td>hugoでのコンテンツ作成用</td>
</tr>
<tr>
<td><!-- raw HTML omitted --></td>
<td></td>
</tr>
</tbody>
</table>
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2019/20190329/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190328/">ブログ開始</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-03-28T13:00:00&#43;09:00">
          Mar 28, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    古いブログ(http://d.hatena.ne.jp/ymraintree/)から引っ越しました。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2019/20190111/">Mac keyhacでキーバインドの変更</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2019-01-11T17:09:00&#43;09:00">
          Jan 11, 2019
        </time>
      </div>
    </div>
  </header>
  <div>
    MacBookProを使っているが、つくづく、コントロールキーとコマンドキーが統合されていればいいのにと思う。Ctrl-aとCmd-aを使い分けるシーンなんてないし。
しばらく前からKeyHacを使って、アプリケーションごとにコントロールキーとコマンドキーの入れ替えをしているが、ちょっとスマートに書けるようになった。
changeKey(keymap.defineWindowKeymap(app_name=&quot;com.google.Chrome&quot;)) changeKey(keymap.defineWindowKeymap(app_name=&quot;com.apple.Preview&quot;)) def changeKey(keymap): keymap[&quot;Ctrl-a&quot;] = &quot;Cmd-a&quot; keymap[&quot;Ctrl-c&quot;] = &quot;Cmd-c&quot; keymap[&quot;Ctrl-d&quot;] = &quot;Cmd-d&quot; 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180917/">Emacsのansi-term</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-09-17T17:09:00&#43;09:00">
          Sep 17, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    いままで、/etc/passwdなどを編集するときはmacのターミナルを起動してそこでviしていたが、普段使っているemacsでM-x ansi-termすると、この中でviを使うことができる。これでターミナル不要になった。ありがたい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180816/">起業</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-08-16T17:09:00&#43;09:00">
          Aug 16, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    7月末に無事、起業。時間はあったのに、あまり準備をせず、そろそろしなきゃとなったら結果、開業freeeのいうがまま。それでもさっくり起業できた。これから銀行の法人口座を作る。楽天銀行かジャパンネットバンクかという感じだけど、楽天のほうが必要書類が少なくてよさそう。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180512/">Datastoreをcsvでエクスポート</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-05-12T17:09:00&#43;09:00">
          May 12, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    Google App Engineでよく使うDatastoreのデータをディープラーニングで使うためにcsvにしようとした。簡単なことと思ったら以外になかなかできず、結局以下の方法で実現できた。
Datastoreのバックアップ BigQueryにインポート 必要なカラムをselectして、Download as csvをクリック
RDBならcopyコマンドとかで一発なんだけど。簡単なことなんだけど。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180305/">Pythonの日時表示</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-03-05T09:00:00&#43;09:00">
          Mar 5, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    日本の日時を表示するには、
import time import os os.environ['TZ'] = 'Japan' time.tzset() time.strftime('%Y/%m/%d %H:%M:%S %Z') とすると 2018/03/05 17:24:54 JST となる。もうちょっといい方法はないかな。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180118/">AWS linuxのディスクを拡張する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-01-18T09:00:00&#43;09:00">
          Jan 18, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    AWSコンソールで当該EBSのサイズを拡張する。 ボリュームの状態が、しばらくすると「in-use - completed (100%)」となる。
$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 10G 0 disk └─xvda1 202:1 0 8G 0 part / $ df -h /dev/xvda1 7.8G 7.6G 0 100% / 変わっていない。
$ sudo growpart /dev/xvda 1 CHANGED: partition=1 start=16065 old: size=16761118 end=16777183 new: size=20955422,end=20971487 $ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 10G 0 disk └─xvda1 202:1 0 10G 0 part / $ sudo resize2fs /dev/xvda1 resize2fs 1.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2018/20180118/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2018/20180115/">国民年金・失業保険</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2018-01-15T09:00:00&#43;09:00">
          Jan 15, 2018
        </time>
      </div>
    </div>
  </header>
  <div>
    思うところあって、2017年末に25年以上勤めた会社を早期退職した。これからどうするかなど、たいしたプランもないなかで、とりあえず必要なことをしていく。
まずは、厚生年金を国民年金にスイッチ。このまま受給日まで国民年金で行った場合、厚生年金と合わせた受給額はいくらになるのかなどは、年金事務所に問い合わせろとのこと。市役所は手続きのみらしい。
つづいてハローワークで失業保険受給の手続き。職業安定所といったら、昔は仕事にあぶれたおじさんたちが肩寄せあってタバコを吸いながらしみったれた話しをしているところ、というイメージだったけど、今はすっかりクリーンになっていて、通っても気持ちが暗くなるということもなさそうで安心した。今の労働市場はどうなっているのか、考えてもいなかったような仕事や環境に出会えるのではないかと、期待も芽生えてきた。
これからどうなっていくのか、随時メモをつけていきたい。あいまにPythonやkotlinの勉強をしようと思う。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2017/20171008/">My First Lambda</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2017-10-08T09:00:00&#43;09:00">
          Oct 8, 2017
        </time>
      </div>
    </div>
  </header>
  <div>
    def checkio(data): return filter(lambda x: 1 &lt; data.count(x), data) if __name__ == &quot;__main__&quot;: #These &quot;asserts&quot; using only for self-checking and not necessary for auto-testing assert list(checkio([1, 2, 3, 1, 3])) == [1, 3, 1, 3], &quot;1st example&quot; assert list(checkio([1, 2, 3, 4, 5])) == [], &quot;2nd example&quot; assert list(checkio([5, 5, 5, 5, 5])) == [5, 5, 5, 5, 5], &quot;3rd example&quot; assert list(checkio([10, 9, 10, 10, 9, 8])) == [10, 9, 10, 10, 9], &quot;4th example&quot; 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2017/20170424/">psqlのデリミタを変更する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2017-04-24T09:00:00&#43;09:00">
          Apr 24, 2017
        </time>
      </div>
    </div>
  </header>
  <div>
    $ psql -A -F $'\t' xxxxxx で出力のデリミタをタブに変更できる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2017/20170214/">EC2 インスタンスのタイムゾーンを変更する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2017-02-14T09:00:00&#43;09:00">
          Feb 14, 2017
        </time>
      </div>
    </div>
  </header>
  <div>
    EC2のLinuxインスタンスは作りたてだとタイムゾーンがJSTではないので、これを変更
$ sudo mv localtime localtime.20170204 $ sudo ln -s /usr/share/zoneinfo/Asia/Tokyo localtime $ date Sat Feb 4 14:48:14 JST 2017 $ 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2017/20170116/">クローンしたVMのファイル名を変更する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2017-01-16T09:00:00&#43;09:00">
          Jan 16, 2017
        </time>
      </div>
    </div>
  </header>
  <div>
    vmwareのVMをクローンすると、.vmdkファイルの名称が変更されてしまう。たとえば、backupVMというVMをクローンすると、
# ls backupVM_2-ctk.vmdk backupVM.nvram backupVM.vmsd backupVM.vmxf backupVM_2-flat.vmdk backupVM_2.vmdk backupVM.vmx vmware.log # となる。これはスクリプトなどで.vmdkファイルを操作するのに都合が悪いので、元のbackupVM.vmdkのように直したい。これをmvなどしてしまうと構成が壊れて動かなくなるようなので、
# vmkfstools -E backupVM_2.vmdk backupVM.vmdk とすると、すべての_2が取れる。
# ls backupVM-ctk.vmdk backupVM.nvram backupVM.vmsd backupVM.vmxf backupVM-flat.vmdk backupVM.vmdk backupVM.vmx vmware.log # さらに、backupVM.vmxの内容にbackupVM_2が残っているので、これを修正する必要がある。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2016/20161222/">keyhac</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2016-12-22T09:00:00&#43;09:00">
          Dec 22, 2016
        </time>
      </div>
    </div>
  </header>
  <div>
    Macをsierraにアップグレードしたらkarabinerが使えなくなったので、かわりにkeyhacを試してみる。
keyhacはkarabinerとちがって、コントロールキーとコマンドキーを交換という定義ができず、常に
keymap[&quot;Ctrl-a&quot;] = &quot;Cmd-a&quot; というふうにメインキーとの組み合わせで定義しなければならないもよう。これは非常の多くの組み合わせがあり、かつ複数のアプリケーションで定義したいので、いちいち全部をconfig.pyに書くのはつらい。そこでメソッド化。
def changeKey(keymap): keymap[&quot;Ctrl-a&quot;] = &quot;Cmd-a&quot; keymap[&quot;Ctrl-c&quot;] = &quot;Cmd-c&quot; keymap[&quot;Ctrl-d&quot;] = &quot;Cmd-d&quot; keymap[&quot;Ctrl-f&quot;] = &quot;Cmd-f&quot; keymap[&quot;Ctrl-p&quot;] = &quot;Cmd-p&quot; keymap[&quot;Ctrl-q&quot;] = &quot;Cmd-q&quot; keymap[&quot;Ctrl-r&quot;] = &quot;Cmd-r&quot; keymap[&quot;Ctrl-s&quot;] = &quot;Cmd-s&quot; keymap[&quot;Ctrl-t&quot;] = &quot;Cmd-t&quot; keymap[&quot;Ctrl-v&quot;] = &quot;Cmd-v&quot; keymap[&quot;Ctrl-w&quot;] = &quot;Cmd-w&quot; keymap[&quot;Ctrl-x&quot;] = &quot;Cmd-x&quot; keymap[&quot;Ctrl-z&quot;] = &quot;Cmd-z&quot; return keymap を作り、
 keymap_chrome = keymap.defineWindowKeymap(app_name=&quot;com.google.Chrome&quot;) keymap_chrome = changeKey(keymap_chrome) で呼び出すようにする。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2016/20161216/">sshセッションのタイムアウトを防止する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2016-12-16T09:00:00&#43;09:00">
          Dec 16, 2016
        </time>
      </div>
    </div>
  </header>
  <div>
    最近AWSを使うことが多くなって、EC2のインスタンスにsshで接続して作業するが、なにかというとタイムアウトするので不便。ちょっと調べたら
サーバの/etc/ssh/sshd_configに
ClientAliveInterval 60 を設定する
~/.ssh/configに
ServerAliveInterval 60 を設定する
のいずれかでタイムアウトしなくなるらしい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2016/20160204/">EntityManager#createNativeQueryで一部のデータを取り出すとき</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2016-02-04T09:00:00&#43;09:00">
          Feb 4, 2016
        </time>
      </div>
    </div>
  </header>
  <div>
    EJBのEntityManagerでテーブルをselectしてそのテーブルのエンティティを返すのは普通にやることだが、group byしてキーだけ取り出したい、などのときは以下のようにObjectの配列のリストとして扱う。
 val keys = em.createNativeQuery(&quot;select t1.key1, t1.key2, t1.key3 &quot; + &quot;from T1 t1 &quot; + &quot;group by t1.key1, t1.key2, t1.key3 &quot; + .getResultList().asInstanceOf[java.util.List[Array[Object] var result = List[fooPK]() keys.foreach(k =&gt; result :+= new fooPK(k(0).toString, k(1).toString.toInt, k(2).toString.toInt)) 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20151019/">pythonで正規表現を使った結果の判定</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-10-19T09:00:00&#43;09:00">
          Oct 19, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    pythonで文字列に数字が含まれているかどうかを判定したいとき、
import re def hantei(v): return re.search(\d, v) とすると、re.search()がBooleanではなく、re.MatchObjectを返すので使えない。こういうときは、
 return re.search(\d, v) is not None とするとすっきり。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150709/">オブジェクトの値をコピーする</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-07-09T09:00:00&#43;09:00">
          Jul 9, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    case class Foo(key:Int, key2:String, key3:Int) のクラスからオブジェクトを生成し、それを他のオブジェクトにコピーしたいとき、scalaではcopyメソッドが使える。
val foo = Foo(100, &quot;test&quot;, 200) val zoo = foo.copy(key = 300) とすると、keyは300がセットされ、他の値は元のオブジェクトからコピーされる。ただし、この機能はcaseクラスのみで、コピーされる対象は()内のプロパティのみ。
case class Foo(key:Int) { var v1:String =_ var v2:Int = _ } だと、v1, v2はコピーされない。
となると、caseクラスのプロパティはすべて()内に書いちゃうほうがいいのかな。キーになる項目だけ（equalsで比較の対象となるべきものだけ）を定義するものだと思っていたんだけど。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150521/">scalaでxmlのCDATAを扱う</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-05-21T09:00:00&#43;09:00">
          May 21, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    普通に
val naiyo = あいうえお x &lt; y var nodes = Queue.empty[Node] nodes :+= &lt;foo&gt;{naiyo}&lt;/foo&gt; みたいなことを書くと、
x &lt; y に変換されてしまう。これをしないように、CDATAを使うには
&lt;foo&gt;{scala.xml.PCData(naiyo)}&lt;/foo&gt; とすればよい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150122/">KarabinerでEclipseのキーバインドを変更</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-01-22T09:00:00&#43;09:00">
          Jan 22, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    eclipse-4.4を使ってみる。Cntl+SPACEでいつものように補完をさせようとするとしなくなった。調べると、Karaibnerがeclipse-4.2と4.4を別に識別しているらしい。~/Library/Application Support/Karabiner/private.xmlを修正する。eclipse-4.2はなにもしないでECLIPSEとして認識されていたが、4.4は
 &lt;appdef&gt; &lt;appname&gt;ECLIPSE_LUNA&lt;/appname&gt; &lt;equal&gt;org.eclipse.platform.ide&lt;/equal&gt; &lt;/appdef&gt; を定義して、
 &lt;item&gt; &lt;name&gt;Swap Control-Space and Command-Space&lt;/name&gt; &lt;only&gt;ECLIPSE&lt;/only&gt; &lt;identifier&gt;private.chrome.swap_controlSpace_and_commandSpace&lt;/identifier&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SPACE, VK_CONTROL, KeyCode::SPACE, VK_COMMAND&lt;/autogen&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SPACE, VK_COMMAND, KeyCode::SPACE, VK_CONTROL&lt;/autogen&gt; &lt;/item&gt; を
 &lt;item&gt; &lt;name&gt;Swap Control-Space and Command-Space&lt;/name&gt; &lt;only&gt;ECLIPSE, ECLIPSE_LUNA&lt;/only&gt; &lt;identifier&gt;private.chrome.swap_controlSpace_and_commandSpace&lt;/identifier&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SPACE, VK_CONTROL, KeyCode::SPACE, VK_COMMAND&lt;/autogen&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SPACE, VK_COMMAND, KeyCode::SPACE, VK_CONTROL&lt;/autogen&gt; &lt;/item&gt; とするとキーバインドを変更できる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150122-3/">scala-2.9のscala.reflect.BeanPropertyが2.11ではscala.beans.BeanPropertyに変更されていた</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-01-22T09:00:00&#43;09:00">
          Jan 22, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    表記の件で、システムのscala-libraryを2.11にあげようとすると、importを変更しなければならない。そこで、
package foo.bar class BeanPropery extends scala.reflect.BeanProperty というクラスを作って、徐々にこれに切り替えておき、2.11に移行するときに上記クラスを
package foo.bar class BeanPropery extends scala.beans.BeanProperty に変更すれば一発で移行できるので便利。ところが、実際に試してみると、2.11ではうまくいくが、2.9ではgetterは生成されるがsetterが生成されないようで、エラーになってしまう。惜しい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150122-2/">Yosemite</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-01-22T09:00:00&#43;09:00">
          Jan 22, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    OSを10.10.1Yosemiteにアップグレードしたところ、eclipse-4.2-junoが起動しなくなった。古いjavaが削除されたらしい。JavaForOSX2014-001.dmgをダウンロードしてインストールしたら起動。しかし、ビルドパスに問題があって、QTJava.zipがないとのこと。こちらはとりあえず、TimeMachineから取り出してクリア。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2015/20150120/">play frameworkのアプリケーションを本番で運用するときに注意すること</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2015-01-20T09:00:00&#43;09:00">
          Jan 20, 2015
        </time>
      </div>
    </div>
  </header>
  <div>
    開発中は
http://localhost:9000/foo などのURLで動作確認するが、開発が終わって本番で稼働するとき、
http://liveserver.boo.com/foo などのURLでアプリケーションにアクセスするようにhttpdの設定をして動かしてみると、なぜか動かない。よくみると、javascriptが動いていない。
これはconf/routesファイルの
GET /assets/*file controllers.Assets.at(path=&quot;/public&quot;, file) を
GET /foo/assets/*file controllers.Assets.at(path=&quot;/public&quot;, file) と修正すれば動くようになる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20141120/">イメージファイルの圧縮</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-11-20T09:00:00&#43;09:00">
          Nov 20, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    kvmでゲストOSをqcow2で運用していると、だんだんとイメージファイルのサイズが大きくなってくる。これをqemu-imgで圧縮するのだが、70G程度あるイメージファイルを圧縮するのに2時間弱かかる。この間ゲストOSを止めておくことができないばあいは、以下の手順だとダウンタイムが少なくてすむ。
 ゲストOSの停止 スナップショット作成   スナップショットで起動 イメージファイル（本体）の圧縮 スナップショットの統合  
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20141107/">セッションの使用</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-11-07T09:00:00&#43;09:00">
          Nov 7, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    play-2.2.3を使用。セッションを使ってコントローラからビューへ値を渡す。sessionの受け渡しを追加し、その内容を.withSessionに入れる。
コントローラ側
 Ok(views.html.index(&quot;&quot;)(session)).withSession(&quot;foo&quot;-&gt;&quot;FOOO&quot;, &quot;bar&quot;-&gt;&quot;BAR&quot;) ビュー側
 @(message: String)(session:play.api.mvc.Session) @session.get(&quot;foo&quot;) 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20141106/">ファイルのアップロード</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-11-06T09:00:00&#43;09:00">
          Nov 6, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    画像ファイルをアップロードするページで、画像を保存するフォルダはplayの外にあり、public/imagesにシンボリックリンクしている場合、アップロードされた画像がページ上に反映されない。
これは、実際の画像ファイルを
./target/scala-2.10/classes/public/images/myimg/xxxxxx.jpg
から参照しているからで、ためしにこのmyimgフォルダもシンボリックリンクにしてみたらうまく反映するようになった。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140818/">スナップショット作成でエラーになったとき</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-08-18T09:00:00&#43;09:00">
          Aug 18, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    kvmのqcow2からvmwareのvmdkへコンバートした仮想マシンをvmwareで起動して、とりあえずスナップショットを取ろう、と実行すると、「&hellip;..vmsn」を保存中にエラーが発生しました。」というエラーでパワーオフまでいってしまう。ディレクトリをみると、xxxVM-00001-s999.vmdkのようなファイルが多数あっておかしな状態に。パワーオンしても、「xxxVM-000001.vmdk」、またはディスク「xxxVM-000001.vmdk」が依存しているスナップショット ディスクの 1 つを開くことができません。 」というエラーで起動できない。
どうもスナップショットを作り損なったのに設定的にはスナップショットができているという状態のようなので、xxxVM.vmxをみると、
ide1:1.fileName = &quot;xxxVM-000001.vmdk&quot; という行があるので、これを
ide1:1.fileName = &quot;xxxVM.vmdk&quot; に変更しパワーオンしたらできた。そこで、パワーオフしてxxxVM-000001*を削除し、再度パワーオンしたら正常起動。これで復旧できたようにみえる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140813/">vmdkの圧縮</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-08-13T09:00:00&#43;09:00">
          Aug 13, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    # du -h liveVM20140813/ 269.6G liveVM20140813/ # このシステムを圧縮。実際には50Gくらい。
# date; time vmkfstools --punc hzero liveVM20140813/liveVM20140813.vmdk; date Wed Aug 13 13:02:13 UTC 2014 vmfsDisk: 1, rdmDisk: 0, blockSize: 1048576 Hole Punching: 100% done. real 6m 9.12s user 1m 11.53s sys 0m 0.00s Wed Aug 13 13:08:22 UTC 2014 # du -h liveVM20140813/ 269.6G liveVM20140813/ # 全然減らない。
そこで、未使用領域をゼロ埋めしてみる。ゼロファイルを作ったらすぐ削除。
$ df -h Filesystem Size Used Avail Use% Mounted on /dev/sda1 95G 3.7G 86G 5% / udev 32G 4.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2014/20140813/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140805/">qcow2からvmdkへ変換するとき</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-08-05T09:00:00&#43;09:00">
          Aug 5, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    -rw-r--r-- 1 root root 28G 8月 5 17:37 zabbixVM.img のファイルをvmdkに変換するとき、圧縮してから変換したほうがvmdkのサイズが小さくなるかと以下のように実行。
$ time sudo qemu-img convert -c -p -f qcow2 -O qcow2 zabbixVM.img zabbixVM.compact.img real	19m57.342s user	18m2.423s sys	0m24.398s $ ls -lh -rw-r--r-- 1 root root 7.4G 8月 5 18:22 zabbixVM.compact.img -rw-r--r-- 1 root root 28G 8月 5 17:37 zabbixVM.img $ time sudo qemu-img convert -p -f qcow2 -O vmdk zabbixVM.compact.img zabbixVM.vmdk real	78m36.654s user	5m4.354s sys	2m59.439s $ ls -lh -rw-r--r-- 1 root root 7.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2014/20140805/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140804/">vmdkのクローン</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-08-04T09:00:00&#43;09:00">
          Aug 4, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    # date; vmkfstools -i foo/barVM.vmdk zoo.vmdk -d thin; date 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140708/">Teamviewerが遅いとき</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-07-08T09:00:00&#43;09:00">
          Jul 8, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    PCを新しくしたところ、teamviewerの画面描画が遅くて使いものにならなくなってしまった。オプション&ndash;&gt;詳細&ndash;&gt;UDPの使用（推奨）をオフにすると速度が出るようになる。理由はわからない。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140630/">Playframework 2.2で非同期メール送信</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-06-30T09:00:00&#43;09:00">
          Jun 30, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    Playで作っているアプリケーションでメール送信が必要になり、普通に書いてみたらメール送信が遅いので画面に制御が帰ってくるまで時間がかかってしまった。手っ取り早く非同期でメールを送信するように改良してみた。
プロジェクト直下のbuild.sbt
libraryDependenciesに
&quot;play.modules.mailer&quot; %% &quot;play-mailer&quot; % &quot;2.1.3&quot; を追加。
resolvers ++= Seq( &quot;Rhinofly Internal Release Repository&quot; at &quot;http://maven-repository.rhinofly.net:8081/artifactory/libs-release-local&quot; ) を追加。
conf/application.confに
mail.failTo=&quot;(sender address)&quot; mail.host=smtp.gmail.com mail.port=465 mail.username=&quot;foo@coo.bar.com&quot; mail.password=xxxxxxxx を追加。
Application.scalaで送信。エラー処理などはまたこんど。
import play.modules.mailer._ import scala.concurrent._ import ExecutionContext.Implicits.global // 添付ファイルの用意 val bis = new BufferedInputStream(new FileInputStream(pdf)) val bArray = Stream.continually(bis.read).takeWhile(-1 !=).map(_.toByte).toArray val email = Email( subject = &quot;サブジェクト&quot;, from = EmailAddress(&quot;送付者名&quot;, &quot;donotreply@coo.bar.com&quot;), text = body, htmlText = body) .to(&quot;受信者名&quot;, &quot;xxxxx@zoo.co.jp&quot;) .withAttachments( Attachment(pdf.getName(), bArray, &quot;application/pdf&quot;)) AsyncMailer.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2014/20140630/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140423/">automountが刺さったら</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-04-23T09:00:00&#43;09:00">
          Apr 23, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    ホームディレクトリをNASに置いて、linuxマシンからはautomountでアクセスするようにしているが、先日NASが異常終了して起動できなくなってしまった。緊急対応として、バックアップのNASサーバを本番のサーバとして使うようにDNSで切り替えた。こんなとき、マシンによってはautomountが以前のサーバにアクセスしようとしてlsコマンドやdfコマンドが刺さってしまう。当該マシンを再起動すればいいことだが、本番運用しているマシンなどは再起動できない。こういうときは
# umount /home/xxx # umount -f /home/xxx # umount -l /home/xxx の順で実行する。-lだとたいていはumountできるもよう。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140122/">ubuntu 起動が遅い場合</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-01-22T09:00:00&#43;09:00">
          Jan 22, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    kvmのゲストOSにubuntu12.04を使っているが、ネットワークの設定を変更してひとつのNICに複数のIPアドレスを振るようにしたらOSの起動時に
Waiting for network configuration... や
Waiting up to 60 more seconds for network configuration... が出て遅くなってしまった。
とりあえず、/etc/init/failsafe.confを修正。
sleep 20をsleep 5に変え、
$PLYMOUTH message --text=&quot;Waiting for network configuration...&quot; || : sleep 40 $PLYMOUTH message --text=&quot;Waiting up to 60 more seconds for network configuration...&quot; || : sleep 59 $PLYMOUTH message --text=&quot;Booting system without full network configuration...&quot; || : sleep 1 をコメントアウトすると起動は速くなる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2014/20140120/">play frameworkの自動起動設定</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2014-01-20T09:00:00&#43;09:00">
          Jan 20, 2014
        </time>
      </div>
    </div>
  </header>
  <div>
    簡単なplayのアプリケーションを作ってさくっとデプロイして本番運用していたが、本番機のロードアベレージが常に1を上回るようになってびっくり。調べると、playのプロセスがCPUを専有していた。単純にplay runで起動していたが、これを変更。
プロジェクト内で
$ play clean compile stage を実行して、target/startファイルが作る。このとき自動起動の環境が整えられるらしい。あとは/etc/init.d/playなどに、
	cd /usr/local/play/name_of_project target/start -server -Xms128m -Xmx128m &amp; などとするとよい。終了用には
	cd /usr/local/play/name_of_project kill -TERM `cat RUNNING_PID` play-2.2.3で変更があったもよう。startコマンドはtarget直下ではなく、
target/universal/stage/bin/name_of_project に変更になった。コマンド名もstartではなくなった。起動スクリプトには以下のように書くべし。
	cd /usr/local/play-2.2.3/name_of_project target/universal/stage/bin/name_of_project -Dhttp.port=9001 &gt; /dev/null 2&gt;&amp;1 &amp; 停止時に使うRUNNING_PIDもtarget直下からtarget/universal/stageに移動した。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20131111/">実行可能Jarファイルの設定</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-11-11T09:00:00&#43;09:00">
          Nov 11, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    Java7になってから、実行可能jarファイルでアプリケーションを起動すると、「JARファイルのマニフェストに権限属性が含まれていないため、このアプリケーションは、今後のJavaセキュリティ・アップデートでブロックされます。」というメッセージが表示されるようになった。これを解消するには、実行可能JarのMANIFEST.MFに
Permissions: all-permissions Codebase: *.foo.bar.com を追加する。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20131025/">Java Web Startの仕様変更</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-10-25T09:00:00&#43;09:00">
          Oct 25, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    Java Web Startで起動するアプリケーションが、Java7 45にアップデートしたら動かなくなった。動かなくなったとはいっても、アプリケーション自身は起動するが、途中でエラーになってしまう。エラーの内容からすると、アプリケーションに渡っているべき環境変数が渡っていない模様。この変数は.jnlpのresourcesタグ内で
&lt;property name=&quot;arg1&quot; value=&quot;FOOBAR&quot;/&gt; のように渡していた。Java側では
String foo = System.getProperty(&quot;arg1&quot;); で受け取ることができた。
これができなくなったようなので調べてみたら http://docs.oracle.com/javase/jp/1.5.0/guide/javaws/developersguide/syntax.html の解説にあるように、
&lt;property name=&quot;jnlp.arg1&quot; value=&quot;FOOBAR&quot;/&gt; のようにするとVMに引数を渡すことができるんだと。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20131010/">scalaとjavaのコレクションのやり取り</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-10-10T09:00:00&#43;09:00">
          Oct 10, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    もっといい方法があると思うけれど、とりあえず実現できたやり方
scalaのMapのvaluesをjava.util.Collectionに変換する
new java.util.ArrayList[UriageForRanking](result.values) 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20131001/">chromeのポップアップをタブで開く</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-10-01T09:00:00&#43;09:00">
          Oct 1, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    リンクをクリックするとポップアップが表示されるかわりにタブで表示させるのに、chromeではTab Position Customizerという機能拡張を使ってきたが、いつのまにかchromeウェブストアからなくなっている。ぐぐってみたらウェブストアでないところに、Tab_Position_Customizer_2.9.1_0.crxというファイルがあるので、これをダウンロードし、chromeに機能拡張の一覧を表示させてそこにドラッグするとインストールできる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130920/">デスクトップフォルダの変更</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-09-20T09:00:00&#43;09:00">
          Sep 20, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    最近virt-managerを使うことが増えて、vncでlinuxにGUIのアクセスをするようになったが、ホームディレクトリにPublicとかDesktopとかフォルダを作られてしまうのがうざい。なので、~/.config/user-dirs.dirsの内容を修正して、別の場所に作られるようにした。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130919/">kvm イメージファイルの操作</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-09-19T09:00:00&#43;09:00">
          Sep 19, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    以下のコマンドで差分ファイルを作ることができる。
$ sudo qemu-img create -b vm.test.img -f qcow2 vm.test.diff.img 以後、vm.test.diff.imgで起動するとベースのvm.test.imgは変更されない。
$ ls -l vm.test.* -rw-r--r-- 1 root root 198656 9月 19 11:46 vm.test.diff.img -rw------- 1 root root 58913259520 9月 19 11:44 vm.test.img $ $ ls -l vm.test.* -rw-r--r-- 1 root root 24838144 9月 19 11:59 vm.test.diff.img -rw------- 1 libvirt-qemu kvm 58913259520 9月 19 11:44 vm.test.img $ 差分をベースにコミットするには以下のコマンド。
$ sudo qemu-img commit -f qcow2 vm.test.diff.img これで差分はいらなくなる。
この方式だと、ベースのイメージが差分バックアップの対象とならないので、バックアップの効率はよくなる。
イメージファイルの圧縮
イメージファイルのサイズが大きくなってきたので圧縮してみる。
$ time sudo qemu-img convert -c -O qcow2 testLinVM.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130919/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130906/">scala objectのMock その2</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-09-06T09:00:00&#43;09:00">
          Sep 6, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    どうもJMockitではscalaのobjectをモック化できないようなので、scalaベースのscalamockを試してみる。scalamockはsbt, scalatestの使用を前提としているため、sbtでプロジェクトを作る。プロジェクトの構成がsbtの構成になってしまうので、これもちょっと困る。環境構築に必要なファイルは以下
$PROJECT_ROOT/build.sbt name := &quot;test.sbt&quot; version := &quot;1.0&quot; scalaVersion := &quot;2.9.2&quot; libraryDependencies ++= Seq( &quot;org.scalatest&quot; %% &quot;scalatest&quot; % &quot;1.8&quot; % &quot;test&quot;, &quot;org.scalamock&quot; %% &quot;scalamock-scalatest-support&quot; % &quot;2.3&quot;, &quot;junit&quot; % &quot;junit&quot; % &quot;latest.integration&quot; % &quot;test&quot;, &quot;commons-logging&quot; % &quot;commons-logging&quot; % &quot;1.1.1&quot; ) $PROJECT_ROOT/project/Build.scala import sbt._ import Keys._ import ScalaMockPlugin._ object MyProject extends Build { override lazy val settings = super.settings ++ Seq( organization := &quot;&quot;, version := &quot;1.0&quot;, scalaVersion := &quot;2.9.2&quot;, libraryDependencies += &quot;org.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130906/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130904/">scala objectのMock</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-09-04T09:00:00&#43;09:00">
          Sep 4, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    テストコードでscalaのobjectをモック化したい。
モック化したいobjectは以下。このクラスはJavaからも呼ぶため、class宣言もしている。
class Boo object Boo { val log = LogFactory.getLog(this.getClass()) def foo = { log.debug(&quot;Boo#foo called&quot;) true } } これをモック化するコード
@MockClass(realClass=classOf[Boo]) object BooMock { val log = LogFactory.getLog(this.getClass()) @Mock def foo = { log.debug(&quot;BooMock#foo called&quot;) false } } テストコード
class JMockitTest { val log = LogFactory.getLog(this.getClass()) @Test def foo { setUpMocks(classOf[BooMock]) log.debug(Boo.foo) } } これを実行しても、
DEBUG (JMockitTest.scala:15) Boo#foo called DEBUG (JMockitTest.scala:51) true となって、モックが呼ばれない。
一方で、テストコードをJavaにしてみる。
public class JMockit2Test { private static Log log = LogFactory.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130904/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130816/">windows上のvirtualboxでゲストの解像度が1920x1050になっちゃった</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-08-16T09:00:00&#43;09:00">
          Aug 16, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    virtualboxのゲストにwindowsを新規インストールして起動。ホストには1920x1080のディスプレイがついているので、ゲストでも当然出せるはずだが、インストール直後にちょっとシームレスモードを試したのが悪かったのか、フルスクリーンモードにしても1920x1050になって天地が余ってしまう。ホストで
&gt; VBoxManage nameOfVM winbox setvideomodehint 1920 1080 32 とか
&gt; VBoxManage setextradata nameOfVM CustomVideoMode1 1920x1080x32 とかやってもかわらず、確かフルスクリーンモードにして、画面下部に出てくるミニツールバーで「ウィンドウサイズの調整」をしたら1920x1080が出るようになった、と思う。いろいろやっているうちに出るようになったので、いまひとつ確信が持てないけれど。
ちなみに、windowsホスト上でゲストを非表示で起動・終了するには以下のようなスクリプトがあるとよい。
start.vbs CreateObject(&quot;WScript.Shell&quot;).Run &quot;&quot;&quot;C:\Program Files\VirtualBox\VBoxHeadless.exe&quot;&quot; -s nameOfVM&quot;, 0 stop.vbs CreateObject(&quot;WScript.Shell&quot;).Run &quot;&quot;&quot;C:\Program Files\VirtualBox\VBoxManage.exe&quot;&quot; controlvm nameOfVM poweroff&quot;, 0 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130815/">linux上のvirtualboxのゲストで1920x1080を表示させる</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-08-15T09:00:00&#43;09:00">
          Aug 15, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    手元のディスプレイが1920x1080でも、virtualboxが乗っているホストにディスプレイがついていない場合、解像度の設定に手間取ることがある。この場合、
 ホストを起動 ホストにsshでログイン $ vnc4server -geometry 1920x1080 手元でvnc接続 virtualboxでゲスト起動  とすると、ゲストの解像度で1920x1080が選べるようになる。ちなみに、ホスト上で
$ vboxmanage startvm guestVM --type headless とするとゲストを非表示で起動することができる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130814/">ゲストOSのディスク容量を増やす</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-08-14T09:00:00&#43;09:00">
          Aug 14, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    ディスク容量100Gで気楽に作ったゲストOSをそのまま運用で使うことになり、500Gへ増やすことにした。
ゲストOS停止 バックアップ
qemu-img resize aplivevm +400G これだけだと、ホストからみた容量は増えたが、ゲストからするとあいかわらず100Gのまま。使用量が100Gを超えるとパンクする。
そこで、ゲストを起動し、
# shutdown now でシングルユーザモードへ移行。virt-managerのコンソールにシングルユーザモードのシェルがでるので、
# fdisk /dev/vda を使うが、ルートパーティションはそのままにして、別のパーティションを追加（/dev/vda3）する。OSを再起動させ、
# mkfs.ext4 /dev/vda3 としたところで、なぜかゲストOS死亡。ためしに
# mkfs.ext3 /dev/vda3 はできた。その後
# mkfs.ext4 -j /dev/vda3 もできたのでよしとする。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130812/">qcow2でイメージファイルを作る</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-08-12T09:00:00&#43;09:00">
          Aug 12, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    イメージファイルをqcow2フォーマットで作る場合は、virt-managerで新規作成する前に、ホスト側で
$ sudo qemu-img create -f qcow2 baseVM-windows7.img 500G としておく。500Gは上限値で、作った当初のサイズは200kにも満たない。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130313/">linuxでiscsi&#43;ocfs2</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-03-13T09:00:00&#43;09:00">
          Mar 13, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    iscsiはひとつのパーティションをひとつのマシンに割り当てるため、NFSほどの自由がなく敬遠してきたが、ocfs2というフォーマットを使えば複数のマシンにアタッチできるというのでやってみる。
iscsiターゲットの構築
$ sudo apt-get install iscsitarget $ sudo apt-get install iscsitarget-dkms /etc/iet/ietd.confを編集
Target iqn.2013-03.testIscsiVM.sdb1:testIscsiVM-loopback Lun 0 Path=/dev/sdb1,Type=blockio のようにiscsiで公開するパーティションを指定。
/etc/default/iscsitargetを編集
ISCSITARGET_ENABLE=true iscsitarget起動
$ sudo /etc/init.d/iscsitarget start ここから、iscsi用のパーティションをocfs2でフォーマットする作業。
iscsiイニシエータをインストール
$ sudo apt-get install open-iscsi ocfs2をインストール
$ sudo apt-get install ocfs2-tools $ sudo iscsiadm -m discovery -t sendtargets -p testIscsiVM 10.5.34.142:3260,1 iqn.2013-03.testIscsiVM.sdb1:testIscsiVM-loopback $ sudo iscsiadm -m node --targetname iqn.2013-03.testIscsiVM.sdb1:testIscsiVM-loopback --login $ sudo iscsiadm -m session このとき、syslogにiscsiのパーティションがアタッチされたことが出力され、デバイスファイル名（/dev/sdcなど）もわかるので、そのデバイスをocfs2でフォーマットする。
$ sudo fdisk /dev/sdc でパーティションを定義して、フォーマット。
$ sudo mkfs.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130313/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130313-2/">ubuntuにKVMをインストール</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-03-13T09:00:00&#43;09:00">
          Mar 13, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    ubuntuは12.04を使用。普通にインストールしたのち、
$ sudo apt-get install kvm libvirt-bin bridge-utils virt-manager デフォルトではゲストOSのネットワークはNATで接続するようになっているが、ゲストOSを各種サーバとして使うために、StaticなIPアドレスが割り当てられるようにブリッジ接続に変更する。
NAT用のインタフェースを削除する
$ sudo brctl show $ sudo virsh net-autostart default --disable $ sudo virsh net-destroy default $ sudo brctl show /etc/network/interfacesの変更。以下のようにbr0を追加する。
auto lo iface lo inet loopback auto eth0 iface eth0 inet manual auto br0 iface br0 inet static address 10.5.34.145 network 10.5.0.0 netmask 255.255.0.0 broadcast 10.5.255.255 gateway 10.5.34.254 dns-nameservers 10.4.34.1 dns-search foo.bar.co.jp bridge_ports eth0 bridge_fd 9 bridge_hello 2 bridge_maxage 12 bridge_stp off 10.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130313-2/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130226/">heartbeat管理下のIPアドレスが消えるトラブル</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-02-26T15:59:40&#43;09:00">
          Feb 26, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    drbd+heartbeatを使用して運用しているサーバで、障害が発生。今までもheartbeatが障害を検知してセカンダリにtakeoverしようとして途中でエラーが発生しtakeoverをあきらめてしまうという現象はあったが、今回はちょっと違った。
以前と同じ現象ならばdrbd配下のパーティションがプライマリにもセカンダリにもマウントされていないような状態になるが、今回はdrbdのパーティションがプライマリに正常にマウントされている。
結局異常があったのはサービスIPアドレスのみ。普段は以下のように実アドレスとは別に付与され、サーバのアドレスとして使用しているが、これだけがなくなっていた。
eth1:1 Link encap:Ethernet HWaddr 8c:89:a5:c3:d8:fb inet addr:10.5.34.125 Bcast:10.5.255.255 Mask:255.255.0.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 Interrupt:20 Memory:f4400000-f4420000 syslogを見てもheartbeat関連のログは残っていなかったが、かわりに
Feb 25 01:51:25 apollo2 kernel: [3666623.094611] e1000e: eth1 NIC Link is Down が残っていた。その後、6秒ほどでNICは復活。つまり、NICがダウンしたことで、heartbeatが付与しているサービスIPアドレスは消えてしまった。その後NICが復活するも、短時間で復旧したためにheartbeatも障害を検知しなかった。したがってサービスIPアドレスは消えたまま、という推測が成り立つ。
とりあえず、消えてしまったサービスIPアドレスを改めて付与するため、以下のheartbeatのコマンドを使用。
$ sudo ./IPaddr 10.5.34.125/16/eth1 start ちなみに
$ sudo ./IPaddr 10.5.34.125/16/eth1 stop とすればIPアドレスを削除することができる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130215/">linuxでsambaのディスクをマウントする</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-02-15T16:02:43&#43;09:00">
          Feb 15, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    ubuntuでNASのディスクをマウントする。
$ sudo apt-get install smbfs でパッケージをインストール。
$ sudo smbmount //foo.bar.co.jp/zoo /zoo -o username=xxxxxx アンマウントはumountコマンドでよい。
$ sudo umount /zoo 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130214/">Javaとの混在環境でのScala</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-02-14T16:05:09&#43;09:00">
          Feb 14, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    もともとJavaで書いているプロジェクトにScalaのコードを混ぜていくと、Eclipseの挙動がおかしくなるときがあって、そういうときはJavaの側からScalaでできているオブジェクトやクラスが軒並み見えなくなる。ビルドしなおしても状況は変わらず。いろいろ試した結果、scalaのobjectを作ったときは同名のクラスも用意しないとJavaがそれらを参照するときにおかしな挙動になるようだ。
 class Foo object Foo { def xxx:String = .... ... } 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130208/">VirtualBoxでSkyDrive</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-02-08T16:07:21&#43;09:00">
          Feb 8, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    VirtualBox上にインストールしたWindows7でSkyDriveを使おうとしても、クラウドにあるファイルのダウンロードがまったく進まない。ちょっと調べて、VirtualBoxのWindows7のネットワーク設定をデフォルトのNATからブリッジアダプターに変更してIPアドレスを別に振るとうまくいくようになった。
参考URL: http://nosuchblogger.com/post/243/virtualbox-and-skydrive
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130201/">MacOS10.6.8アップデートでjavawsが動かなくなった</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-02-01T16:08:43&#43;09:00">
          Feb 1, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    表記のとおりの現象が起き、javawsを利用した業務システムが動かなくなるという怖い現象が起きた。いろいろ調べた結果、Java for OS X Developer Preview 11M4001+10M4001というものがあるというので、apple developers centerからjavadeveloper_for_mac_os_x_10.6_update_12__10m4001.dmgをダウンロードしてインストールすると解決する。これにより、javaのバージョンは1.6.0_37から1.6.0_38に上がった。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130129/">リモートからのEJB呼び出し</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-01-29T15:28:41&#43;09:00">
          Jan 29, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    なかなか呼び出せなくて苦労したが、できてしまえば簡単。以下のメソッドを用意する。
private def getBean:ZZZZZZSession = { val props = new Hashtable[String, AnyRef]; props.put(Context.INITIAL_CONTEXT_FACTORY, &quot;org.jboss.naming.remote.client.InitialContextFactory&quot;); props.put(Context.PROVIDER_URL, &quot;remote://foo.bar.com:4447&quot;); props.put(Context.SECURITY_PRINCIPAL, &quot;appuser&quot;); props.put(Context.SECURITY_CREDENTIALS, &quot;xxxxxx&quot;); props.put(&quot;jboss.naming.client.ejb.context&quot;, true.asInstanceOf[java.lang.Boolean]); //	props.put(Context.URL_PKG_PREFIXES, &quot;org.jboss.ejb.client.naming&quot;); val ctxRemote = new InitialContext(props); ctxRemote.lookup(&quot;yyyyyy/ZZZZZZSessionBean!boo.zoo.ZZZZZZSession&quot;).asInstanceOf[ZZZZZZSession] } 上記yyyyyyはデプロイしたjarの名称（.jarは除く）。これでセッションビーンが取得できるので、メソッドも呼び出せるようになる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130128/">JBoss7にscalaで書いたプロジェクトをデプロイする</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-01-28T15:31:04&#43;09:00">
          Jan 28, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    scalaで書いたEJBのプロジェクトをデプロイするには、
modules/org/scala/mainディレクトリ作成して、modules.xmlを以下の内容で作成。scala-library.jarも置く。
&lt;module xmlns=&quot;urn:jboss:module:1.1&quot; name=&quot;org.scala&quot;&gt; &lt;resources&gt; &lt;resource-root path=&quot;scala-library.jar&quot;/&gt; &lt;/resources&gt; &lt;dependencies&gt; &lt;/dependencies&gt; &lt;/module&gt; scalaを参照するEJBプロジェクトはMETA-INFに以下の内容でjboss-deployment-structure.xmlを作成。
&lt;jboss-deployment-structure&gt; &lt;deployment&gt; &lt;dependencies&gt; &lt;module name=&quot;org.scala&quot; /&gt; &lt;/dependencies&gt; &lt;/deployment&gt; &lt;/jboss-deployment-structure&gt; これでデプロイが正常にされる。
上記設定をせずに、scala-library.jarをstandalone/deploymentsに入れてEJBプロジェクトをデプロイしても、
java.lang.NoClassDefFoundError: scala/ScalaObject のエラーが出て正常にデプロイできない。
&laquo;追記&raquo; その後の調査で、scala-library.jarをstandalone/deploymentへ置き、jboss-deployment-structure.xmlに
&lt;module name=&quot;deployment.scala-library.jar&quot; /&gt; で参照できると判明。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130125/">openntpdとisc-dhcp-serverの自動起動</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-01-25T15:33:57&#43;09:00">
          Jan 25, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    openntpdとisc-dhcp-serverが、ubuntu起動時に起動しない。ただし、OS起動後に/etc/init.d/openntpd startとすると起動する。/etc/rc5.dにあるS20openntpd, S20isc-dhcp-serverをS99に移動したりしてみたがだめ。S99rc.localから実行される/etc/rc.localに
/etc/init.d/isc-dhcp-server start /etc/init.d/openntpd start exit 0 と書いてみたらdhcpdは起動するようになった。しかし、ntpdはエラー。syslogには以下のメッセージ。
fatal: bind: Cannot assign requested address そこで、/etc/rc.localを
/etc/init.d/isc-dhcp-server start sleep 10 /etc/init.d/openntpd start exit 0 としたら動くようになった。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130117/">Mac emacsのバージョン</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-01-17T15:35:29&#43;09:00">
          Jan 17, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    brewでemacsをインストールすると、24.2.1が入ったが、以前使っていた23に比べて、
sshでリモートマシンにログインした時のファイル名補完が遅い。 別のアプリでコピーしたテキストを中ボタンクリック（マジックトラックパッドでの3本指タップ）でペーストできない。
などの不便な点があり、ためしに、http://emacsformacosx.com/builds　から23.4をダウンロードしてインストールしたら上記問題は解決。しばらくはこれで様子をみる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2013/20130108/">Mac CPAN</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2013-01-08T15:37:25&#43;09:00">
          Jan 8, 2013
        </time>
      </div>
    </div>
  </header>
  <div>
    開発用にMac miniを買って、eclipseなどインストールしたところ、perlのスクリプトにJcodeが見えないというエラーが。せっかくだからJcodeをインストール。
bash-3.2$ sudo perl -MCPAN -e shell cpan[1]&gt; install Jcode ついでにinstall Pgもしたがエラー。
cpan[3]&gt; install Pg Running install for module 'Pg' Running make for M/ME/MERGL/pgsql_perl5-1.9.0.tar.gz Checksum for /Users/yano/.cpan/sources/authors/id/M/ME/MERGL/pgsql_perl5-1.9.0.tar.gz ok CPAN.pm: Going to build M/ME/MERGL/pgsql_perl5-1.9.0.tar.gz Configuring Pg Remember to actually read the README file ! please set environment variables POSTGRES_INCLUDE and POSTGRES_LIB ! Warning: No success on command[/usr/bin/perl Makefile.PL] MERGL/pgsql_perl5-1.9.0.tar.gz /usr/bin/perl Makefile.PL -- NOT OK Running make test Make had some problems, won't test Running make install Make had some problems, won't install Failed during this command: MERGL/pgsql_perl5-1.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2013/20130108/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20121031/">ssh.el</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-10-31T15:39:29&#43;09:00">
          Oct 31, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    ssh.elを使ってリモートホストにアクセスするとき、-l taro付きで開いたバッファ上から別のsshアクセスを-lなしですると、-l taroが付け加えられてしまう。これを防ぐには、init.elに
'(ssh-explicit-args (quote (&quot;-lhanako&quot;))) のようにデフォルトのユーザ名をセットしておくとよい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20121024/">KeyRemap4MacBookにアプリケーションを追加する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-10-24T15:40:38&#43;09:00">
          Oct 24, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    KeyRemap4MacBookで設定をしていて、TeamViewerへの変更が効かないことに気づいた。調べたところ、
http://pqrs.org/macosx/keyremap4macbook/xml-appdef.html.ja
を参考にしてできた。
メニューバーにあるKeyRemap4MacBookのアイコンからLaunch EventViewerをクリック。 TeamViewerのウィンドウをアクティブにするとEventViewerのCurrent Applicationにcom.teamviewer.TeamViewerと表示される。 private.xmlに以下を追加
&lt;appdef&gt; &lt;appname&gt;TEAMVIEWER&lt;/appname&gt; &lt;equal&gt;com.teamviewer.TeamViewer&lt;/equal&gt; &lt;/appdef&gt; を追加。これで、設定にTEAMVIEWERというキーワードが使える。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20121023/">KeyRemap4MacBookでControlとCommandキーを入れ替える</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-10-23T15:41:47&#43;09:00">
          Oct 23, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    Macを使っていると、Emacs, Terminal以外では、ほとんどコントロールキーを使わず、コマンドキーをメインで使う。しかし、コマンドキーは位置がスペースバーのとなりで、ほかのキーと組み合わせるのに押しづらい。なので、Emacs, Terminalなど以外のアプリケーションのときはコントロールキーとコマンドキーを入れ替えることにした。KeyRemap4MacBookの~/Library/Application Support/KeyRemap4MacBook/private.xmlは以下のとおり。
&lt;item&gt; &lt;name&gt;Swap Control and Command&lt;/name&gt; &lt;not&gt;EMACS, TERMINAL, TEAMVIEWER, VIRTUALMACHINE&lt;/not&gt; &lt;identifier&gt;private.swap_control_and_command&lt;/identifier&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::CONTROL_L, KeyCode::COMMAND_L&lt;/autogen&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::COMMAND_L, KeyCode::CONTROL_L&lt;/autogen&gt; &lt;/item&gt; 以前は
&lt;item&gt; &lt;name&gt;Swap Control-/ and Command-/&lt;/name&gt; &lt;only&gt;ECLIPSE&lt;/only&gt; &lt;identifier&gt;private.eclipse.swap_control/_and_command/&lt;/identifier&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SLASH, VK_CONTROL, KeyCode::SLASH, VK_COMMAND&lt;/autogen&gt; &lt;autogen&gt;--KeyToKey-- KeyCode::SLASH, VK_COMMAND, KeyCode::SLASH, VK_CONTROL&lt;/autogen&gt; &lt;/item&gt; のように個々のキーの組み合わせを記述していたが、これでは取りこぼしもあるので、全体的に入れ替えるようにしてすっきりした。ただし、カスタマイズしたMacに慣れることで、普通のMacが使えなくなるのでは、という不安が…。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120919/">qnapのcronの設定</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-19T15:43:03&#43;09:00">
          Sep 19, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    普通にcrontab -eで設定してもなにかのタイミングで消えてしまう。
# vi /etc/config/crontab # /etc/init.d/crond.sh restart このとき、/tmp/cronを削除なり移動なりしておく。restartで/tmp/cronが作りなおされて初めて有効になる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120911/">ubuntuでavahi-daemonなどの停止</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-11T15:44:06&#43;09:00">
          Sep 11, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    サーバとして使っているubuntuなので、avahi-daemonは（たぶん）不要ということで、以下のように起動しないようにした。
$ sudo /etc/init.d/avahi-daemon stop $ sudo update-rc.d -f avahi-daemon remove 他には
$ sudo update-rc.d XXXXXX disable で起動しなくなるものもあるらしい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120905/">heartbeat環境構築</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-05T16:00:51&#43;09:00">
          Sep 5, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    $ dpkg --list|grep heartbeat $ sudo apt-get install heartbeat $ dpkg --list|grep heartbeat /etc/ha.d/{authkeys, ha.cf, haresources}を設定。元ネタは/usr/share/doc/heartbeatにある。
heartbeatの管理下に置くプロセスはharesourcesに記述するとともに、OS起動時に起動しないようにしておくこと。
起動
$ sudo /etc/init.d/heartbeat start 確認
$ sudo /etc/init.d/heartbeat status 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120905-2/">drbd環境構築</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-05T15:04:16&#43;09:00">
          Sep 5, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    プライマリでの作業
$ dpkg --list|grep drbd $ sudo apt-get install drbd8-utils $ dpkg --list|grep drbd /etc/drbd.confの設定
メタデータ領域の作成
$ sudo dd if=/dev/zero of=/dev/sda2 bs=20M count=1 メタデータ作成
$ sudo drbdadm create-md r0 ここまでをセカンダリでも同様に行う。ただし/etc/drbd.confは同じ内容なのでscpする。
プライマリ、セカンダリともdrbd起動。このとき、drbdで使用するディスクをアンマウントしておくこと
$ sudo /etc/init.d/drbd start 状態を確認。プライマリ、セカンダリとも以下のように、同期が取れていない状態。
$ cat /proc/drbd version: 8.3.11 (api:88/proto:86-96) srcversion: 71955441799F513ACA6DA60 0: cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent C r----- ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:402439136 $ あるいは
$ drbd-overview 0:??not-found?? Connected Secondary/Secondary Inconsistent/Inconsistent C r----- $ 強制的にプライマリを指定。当然ながら、プライマリサーバで実行。この処理はインストール時のみ。
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2012/20120905-2/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120904/">emacs trampでリモートのファイルをrootで開く</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-04T16:06:51&#43;09:00">
          Sep 4, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    http://philos0.blog94.fc2.com/blog-entry-20.html
を参考に
init.elに以下を追加
(add-to-list 'tramp-default-proxies-alist '(&quot;\\'&quot; &quot;\\`root\\'&quot; &quot;/ssh:%h:&quot;))	(add-to-list 'tramp-default-proxies-alist '(&quot;自ホスト名\\'&quot; &quot;\\`root\\'&quot; nil)) (add-to-list 'tramp-default-proxies-alist '(&quot;localhost\\'&quot; &quot;\\`root\\'&quot; nil)) C-x C-f /sudo:remoteserver:/etc/hosts が使えるようになった。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120904-2/">apt関係のコマンド</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-09-04T15:08:14&#43;09:00">
          Sep 4, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    ubunbuのパッケージ管理に関するコマンド
検索
apt-cache search XXXXXX インストール
apt-get install XXXXXX インストール済パッケージの一覧
dpkg --list アンインストール
apt-get remove XXXXXX 設定まで消すときは
apt-get --purge remove XXXXXX 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120530/">postgres ストリーミングレプリケーション</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-05-30T16:09:52&#43;09:00">
          May 30, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    ホットスタンバイ・非同期の設定
準備 ロールの作成
$ psql postgres postgres=# create role repl_user login replication password 'xxxxxx'; アーカイブディレクトリの作成
$ sudo mkdir /usr/local/pgsql/archive $ sudo chown postgres /usr/local/pgsql/archive 設定ファイル postgresql.conf
wal_level = hot_standby archive_mode = on archive_command = 'test ! -f /usr/local/pgsql/archive/%f &amp;&amp; cp %p /usr/local/pgsql/archive/%f' max_wal_senders = 2 pg_hba.conf
host replication repl_user 192.168.0.2/32 md5 ベースバックアップ 上記の準備をして、マスタのpostgresを再起動し、設定を反映させる。 スタンバイでベースバックアップ。
$ pg_basebackup -h 192.168.0.1 -p 5432 -U repl_user -D /usr/local/pgsql/data --format=plain --checkpoint=fast --label=label1 --progress --verbose スタンバイサーバの設定 postgresql.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2012/20120530/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120518/">heartbeat&#43;drbd&#43;postgresトラブル</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-05-18T16:15:00&#43;09:00">
          May 18, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    これまでpgpoolII+postgresでライブのDBを構成していたが、サーバを安いPCサーバにリプレイスするのをきっかけに、heartbeat+drbd+postgresに変えることにした。
先日、プライマリとなっていたサーバ1が落ち、heartbeatによってセカンダリのサーバ2がプライマリに切り替わった。その際、postgresにエラーが発生。pg_dumpを取ろうとすると、
pg_dump: SQLコマンドが失敗しました pg_dump: サーバのエラーメッセージ: ERROR: could not access status of transaction 4294692688 DETAIL: Could not open file &quot;pg_clog/0FFF&quot;: No such file or directory. pg_dump: 次のコマンドでした: COPY public.ziplog (zipcd, address1, address2, logaction, logdate) TO stdout; pg_dumpall: データベース&quot;common&quot;に対するpg_dumpが失敗しました。終了します ネットでいろいろ調べ、
 $ dd bs=256k count=1 if=/dev/zero of=0FFF 1+0 records in 1+0 records out 262144 bytes (262 kB) copied, 0.000511307 s, 513 MB/s $ で0FFFファイルを作ってみた。すると、今度は別のclogファイルがないという。
 # select count(*) from ziplog; ERROR: could not access status of transaction 2319990784 DETAIL: Could not open file &quot;pg_clog/08A4&quot;: No such file or directory.
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2012/20120518/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120517/">AWSへrsync</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-05-17T16:16:47&#43;09:00">
          May 17, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    手元のマシンからリモートのAWSのインスタンスへrsync。
rsync -avz -e 'ssh -i /foo/bar/zoo.pem' PDFClown-0.1 ec2-user@aws-sandbox:/disk4/backup 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120309/">AWSのインスタンスにディスクをマウント</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-03-09T16:17:55&#43;09:00">
          Mar 9, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    マネージメントコンソールでボリュームを作成。インスタンスにアタッチすると、デバイス名(/dev/sdiなど)が表示されるので、インスタンスにログインして、
$ sudo mkfs -t ext3 /dev/sdi $ sudo mount /dev/sdi /disk4 で使えるようになる。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120123/">ScalaのEJBをJavaから参照する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-01-23T16:18:58&#43;09:00">
          Jan 23, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    以前からscalaでEJBを書いていたが、ここへ来て問題発生。JavaとScalaの混在プロジェクトでJavaからScalaのクラスを参照したときにコンパイルエラーにはならないのに、eclipseのエディタ上ではエラーの表示がされてしまう。これを解決するには
Java同様、Scalaのクラスもパッケージと同じ位置に置く。
case class Foo( @(Id @field) x:Int, @(Temporal @field)(value=TemporalType.DATE) @BeanProperty nyukinDate:Date, @(Column @field)(columnDefinition=&quot;numeric(13, 2)&quot;) @BeanProperty var shohizei:Double, @(Column @field)(columnDefinition=&quot;text&quot;, nullable=false) @BeanProperty var userName:String = _ y:String ) をやめて
import scala.annotation.target.field object ScalaAnnotations { type Id = javax.persistence.Id @field type Temporal = javax.persistence.Temporal @field type Column = javax.persistence.Column @field } を定義し、
import boo.ScalaAnnotations._ case class Foo( @Id x:Int, @Temporal(TemporalType.DATE) @BeanProperty nyukinDate:Date, @Column(columnDefinition=&quot;numeric(13, 2)&quot;) @BeanProperty var shohizei:Double, @Column(columnDefinition=&quot;text&quot;, nullable=false) @BeanProperty var userName:String = _ y:String ) とする。
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2012/20120123/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120119/">galaxy nexus</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-01-19T16:20:43&#43;09:00">
          Jan 19, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    なんとなく衝動的にgalaxy nexus購入。ひととおりセットアップを終えて使用開始。日本語入力はFlickWnnがいい感じ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2012/20120112/">AspectJのプラグイン</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2012-01-12T16:21:31&#43;09:00">
          Jan 12, 2012
        </time>
      </div>
    </div>
  </header>
  <div>
    久しく使っていないけれど、以前のプロジェクトで使っていたAspectJ。Eclipse 3.7にプラグインをインストール。
http://download.eclipse.org/tools/ajdt/37/update
だとプロジェクトがエラーになってしまうが、
http://download.eclipse.org/tools/ajdt/37/dev/update
ならばOK。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20111206/">gmailをSMTPサーバとしてjavaからメールを送信する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-12-06T16:23:06&#43;09:00">
          Dec 6, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    会社のメールサーバをgmailに切り替えたことにともない、システムから出すメールのSMTPサーバもgmailに切り替えました。すると、ときどき以下のエラーでメールが送信されないという現象が起きるようになりました。
2011-12-06 09:23:33,368 FATAL [javax.enterprise.resource.webcontainer.jsf.applic ation org.jboss.web.jsf.integration.config.Log4JConversionFilter.logWithThrowabl e(Log4JConversionFilter.java:109)] java.lang.SecurityException: Access to defaul t session denied javax.faces.el.EvaluationException: java.lang.SecurityException: Access to defau lt session denied いったんこれが出るとサーバ(Jboss)を再起動しない限りメールは送信されません。ちょっと調べたら、Session session = Session.getDefaultInstanceをSession session = Session.getInstanceに変えるべしという情報があったので変えてみました。効果はしばらく様子を見ないとわからないんですが。
参考URL: http://www.java.net/node/697528
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20111202/">EJB-QLのチューニング</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-12-02T16:24:27&#43;09:00">
          Dec 2, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    EJBをDBから取り出すときにSQLに似たEJB-QLを使うわけですが、
@NamedQuery(name=&quot;torihiki.findForReport&quot;, query=&quot;select torihiki from Torihiki torihiki &quot; + &quot;left outer join fetch torihiki.torihikiMeisais torihikiMeisai &quot; + &quot;where torihiki.nohinDate = :nohinDate&quot;) のような書き方をします。これが遅いといわれ、チューニングしたりしたんですが、効果が出ず。結局、left outerをやめてただのjoinにしたらてきめん速くなりました。joinの使い方を勉強しなおさなければ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20111114/">Entity BeanでCREATE INDEXする</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-11-14T16:25:18&#43;09:00">
          Nov 14, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    アプリケーションのチューニングをして、DBにインデックスを張りたいとき、SQLを直に実行してしまうと移植時などに忘れてしまうことがあるので、Entity Bean内に書いておきたい。調べると、
@Table(indexes = {@Index(name=&quot;customer_idx&quot;, columnNames = {&quot;customerCd&quot;, &quot;customerKbnCd&quot;}), @Index(name=&quot;customer_idx2&quot;, columnNames = {&quot;seikyuDate&quot;})}, appliesTo = &quot;customer&quot;) などと書ける。しかしいくらデプロイしてもインデックスがcreateされない。persistence.xmlの
&lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/property&gt; を
&lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;create&lt;/property&gt; にするとインデックスが作られるが、テーブルごと作り直されてしまうため、データがなくなってしまう。うーむ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20111017/">jbossのtransaction timeoutの制御</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-10-17T16:26:28&#43;09:00">
          Oct 17, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    jbossで大きなバッチ処理などするとtimeoutで落ちてしまうことがある。このようなとき、そのメソッドだけtimeout値を変更するには、以下のアノテーションをメソッドに付ける
@TransactionTimeout(1500) 参照URL: http://community.jboss.org/wiki/TransactionTimeout
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110930/">linuxサーバでpdfファイルの印刷</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-09-30T16:27:20&#43;09:00">
          Sep 30, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    linuxサーバ上のjbossでpdfファイルを生成し印刷する必要が生じました。pdfはjasperReportなどで生成できますが、これを普通にlprとかしても日本語が出ません。jasperReport側でフォントの設定などをいろいろと変えてみたが解決せず。
サーバにacrobat readerを入れるという方法をためしてみました。
linuxサーバは64bitでacrobat readerは32bit版しか提供されていません。なので、AdbeRdr9.4.2-1_i486linux_jpn.tar.bz2をダウンロード、解凍し、
# cd AdobeReader # ./INSTALL としてインストール。
acroread -toPostScript -pairs foo.pdf foo.ps; lpr -P myprinter foo.ps とすると印刷できました。ただしASCIIのフォントがちょっと変。
なお、linux上のacroreadはrootで実行するとエラーになってしまうので、別人になって実行する必要がある。scalaではこんな感じ。
val cmd = Array(&quot;su&quot;, &quot;-&quot;, &quot;nobody&quot;, &quot;-c&quot;, &quot;acroread -toPostScript -pairs foo.pdf foo.ps; lpr -P myprinter foo.ps&quot;) val p = Process(cmd).run if (p.exitValue != 0) { println(&quot;異常終了 &quot; + p.toString()) } 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110929/">drbdの再同期</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-09-29T16:31:58&#43;09:00">
          Sep 29, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    drbdのフェイルオーバのテストなどをしていると、
$ cat /proc/drbd version: 8.3.9 (api:88/proto:86-95) srcversion: CF228D42875CF3A43F2945A 0: cs:StandAlone ro:Secondary/Unknown ds:Inconsistent/DUnknown r----- ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:976531312 $ のような状態になる。これはプライマリとセカンダリが同期していない状態。こういう場合の再同期の処理。
セカンダリ側
$ sudo drbdadm down r0 $ sudo drbdadm up r0 $ sudo drbdadm invalidate r0 $ cat /proc/drbd version: 8.3.9 (api:88/proto:86-95) srcversion: CF228D42875CF3A43F2945A 0: cs:WFConnection ro:Secondary/Unknown ds:Inconsistent/DUnknown C r----s ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:976531312 $ プライマリ側
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2011/20110929/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110927/">drbdマシンの起動時の処理</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-09-27T16:33:01&#43;09:00">
          Sep 27, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    drbdのマシンを再起動したときに、以下の処理をしないと正常に起動しない。
ログイン
drbd-overviewで確認 sudo drbdadm down r0 sudo drbdadm up r0 sudo drbdadm primary r0 (sudo drbdsetup (0 or /dev/drbd0) primary でも可) drbd-overviewで確認 sudo mount /drbd 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110926/">drbd</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-09-26T16:34:30&#43;09:00">
          Sep 26, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    2台のlinuxマシンを使ってdrbd環境構築。drbd用のパーティションとして1TBを取ってしまったので初期同期に一週間くらいかかってしまった。このパーティションで実用していいんだろうか。
障害時の切り替え手順
現プライマリ側
sudo umount /drbd sudo drbdsetup /dev/drbd0 secondary 新プライマリ側
sudo drbdsetup /dev/drbd0 primary sudo mount /dev/drbd0 /drbd どちらもcat /proc/drbdなどして確認。drbd-overviewだと
0:??not-found?? Connected Primary/Secondary UpToDate/UpToDate C r----- /drbd\ ext4 917G 665M 870G 1% となる。not-foundってなんだろう。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110831/">solr</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-31T16:35:34&#43;09:00">
          Aug 31, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    solrを使ってみる。解凍して、
$ cd apache-solr-3.3.0/ $ cd example/ $ java -jar start.jar で起動。PDFを読み込ませたいときは
$ curl &quot;http://localhost:8983/solr/update/extract?literal.id=doc1&amp;commit=true&quot; -F &quot;myfile=@XXXXXXX.pdf&quot; などとする。データの削除は
$ sudo java -Ddata=args -jar exampledocs/post.jar &quot;&lt;delete&gt;&lt;id&gt;vvvvvv&lt;/id&gt;&lt;/delete&gt;&quot; とか
$ sudo java -Ddata=args -jar exampledocs/post.jar &quot;&lt;delete&gt;&lt;query&gt;kkkkkk:vvvvvv&lt;/query&gt;&lt;/delete&gt;&quot; 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110830/">findの-execで複数のコマンドを実行する</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-30T16:36:46&#43;09:00">
          Aug 30, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    eclipseのプロジェクトのエンコーディングをまちがえてMS932で結構なファイル数のコードを書いてしまった。これを一気にUTF-8に変換したい。まずは以下のシェルスクリプトを作成
echo $1 nkf -w $1 &gt; /tmp/foo mv /tmp/foo $1 これをfindで実行。
$ find . -type f -exec sh z:/foo.sh {} \; 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110829/">play&#43;scala&#43;morphia</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-29T16:39:14&#43;09:00">
          Aug 29, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    $ ./play install morphia $ ./play new myapp --with scala myapp/conf/dependencies.ymlに以下の行を追加する。
- play -&gt; morphia 1.2.2beta1 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110828/">play&#43;scala&#43;mongo</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-28T16:40:53&#43;09:00">
          Aug 28, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    $ ./play install mongo $ ./play new myapp --with scala mongo myapp/conf/application.confに以下を追加
# The mongo module module.mongo=${play.path}/modules/mongo # mongodb connection details mongo.host=localhost mongo.port=27017 mongo.database=play mongo.username=test mongo.password=test123 $ ./play run myapp 以下のエラー。
~ Oops, ~ Module not found: /net/ares/disk1/home/yano/project/play-1.2.2/modules/mongo myapp/conf/application.confの
module.mongo=${play.path}/modules/mongo を
module.mongo=${play.path}/modules/mongo-1.3 に変更したら動いた。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110819/">caseクラスでパラメータにアノテーション　続き</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-19T16:46:57&#43;09:00">
          Aug 19, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    前回caseクラスでパラメータにアノテーションを書いても効かなかったと書きましたが、正確にはjavaのアノテーションは効かないということでした。
case class Shohin ( @BeanProperty pk:String これは効くけれど、
case class Shohin ( @Column columnDefinition=&quot;text&quot;) pk:String これは効かない。これが効かないのはしょうがないとしても、
case class Shohin ( @Id pk:String これが効かないと、EJBコンテナにデプロイしたときにエラーになってしまうので、致命的。それでcaseクラスを諦めていたわけですが、
http://www.davidgreco.it/MySite/Blog/Entries/2011/2/16_Scala_and_JPA__a_couple_of_hints.html
に解決方法がありました。
import scala.annotation.target._ case class Shohin ( @(Id @field) @(Column @field)(columnDefinition=&quot;text&quot;) pk:String とするということです。なにはともあれ、エンティティビーンにcaseクラスが使えるようになったのは、とてもうれしい。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110817/">caseクラスでパラメータにアノテーション</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-17T16:48:08&#43;09:00">
          Aug 17, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    EJBのエンティティビーンをscalaで書こうと、
@Entity @Cache(usage=CacheConcurrencyStrategy.NONE) case class Foo(@Id k:Int, v:String) としてみたところ、以下のエラー。
Reason: org.hibernate.AnnotationException: No identifier specified for entity: Foo どうも、@Idアノテーションが効いていない様子。
http://scala-programming-language.1934581.n4.nabble.com/scala-case-classes-and-parameter-annotations-td2002485.html
によると、バグとのこと。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110802/">fessでPDF全文検索</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-08-02T16:49:16&#43;09:00">
          Aug 2, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    PDFファイルの全文検索がしたいということで、ちょっと調べたらfessというものがあって、solrに検索用のページなどをつけたオールインワンなプロダクトのようで、試しに使ってみました。
fessを動かすサーバ内のディレクトリにPDFファイルを置いておき、そこを指定してfessにクロールさせる、それを検索ページで表示させる、というのが目標。
バージョンはfess-server-4.1.0。インストールはzipを解凍するだけ。bin/startup.shで起動すると
http://xxxxxx.co.jp:8080/fess/admin/
で管理画面に行けます。ここでPDFファイルを置いているディレクトリを指定してクロール開始。しばし待つと、完了する（経過はfess-server-4.1.0/webapps/fess/WEB-INF/logs/fess_crawler.outで見ることができる）。
ここで検索画面http://xxxxxx.co.jp:8080/fess/にアクセスして、てきとうなキーワードで検索する。するとヒットしたPDFファイルが列挙される。
ここまではいいんですが、列挙されたPDFファイルへのリンクをクリックしても画面が白くなってしまい、PDFの内容が表示されませんでした。
いろいろやってみたんですが、うまくいかず、結局fess-server-4.1.0/webapps/fess/js/search.jsの内容を書き換えて、
b.push(&quot;go?rt=&quot;); b.push(a); b.push(&quot;&amp;u=&quot;); b.push(encodeURIComponent(c)); を
b.push(&quot;docs&quot;); var len = c.lastIndexOf(&quot;/&quot;); var file = c.slice(len); b.push(file); とし、クロールするディレクトリと同様のものをfess-server-4.1.0/webapps/fess/にも置くということで対処。いまいちだけど、とりあえず動きました。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110722/">play&#43;scalaプロジェクトをeclipseにインポートする</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-07-22T16:50:30&#43;09:00">
          Jul 22, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    play+scalaでちょっとずつ書き始めたので、そろそろeclipseも試そうと思いました。
$ ./play eclipsify xxxxx してeclipseにインポートしたんですが、scalaのコードにコンパイルエラーが出てしまいました。すでに動いているものなのに。playのeclipsifyでクラスパスもきっちり設定されているのに。気を取り直してよくよく調べるとplay-1.2.1/modules/scala-0.9/libのplay-scala.jarとscalatest-1.2-zzzzzzzzzzzz.jarをインポートしたらコンパイルエラーは出なくなりました。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110714/">mongodb&#43;casbah&#43;scala</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-07-14T16:51:30&#43;09:00">
          Jul 14, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    遅まきながらmongodbの勉強。sbt-0.10でプロジェクトを作る。
$ mkdir sbt-mongo $ cd sbt-mongo ここで、build.sbtを作成。内容は以下。
name := &quot;Hello Mongo+Casbah&quot; version := &quot;1.0.0&quot; scalaVersion := &quot;2.9.0&quot; organization := &quot;&quot; libraryDependencies ++= Seq( &quot;com.mongodb.casbah&quot; % &quot;casbah_2.9.0-1&quot; % &quot;2.1.5-1&quot; ) mainClass in(Compile, run) := Some(&quot;mongo.casbah.Sample&quot;) で、sbt実行
$ sbt するとproject, targetディレクトリができる。ここで、src/main/scala/mongo.casbah/Sample.scalaを以下のように作成。
package mongo.casbah import com.mongodb.casbah.Imports._ object Sample { def main(args:Array[String]) { val collection = MongoConnection()(&quot;casbah_test&quot;)(&quot;sample&quot;) val user = MongoDBObject(&quot;id&quot;-&gt;1, &quot;name&quot;-&gt;&quot;me&quot;, &quot;address&quot;-&gt;&quot;テスト満載&quot;) println(user) collection += user collection.find().foreach { println(_) } } } で、sbtプロンプトでrunすると、
  </div>
  
  <footer>
    <ul class="pager">
      <li class="next"><a href="https://ymraintree.github.io/blog/post/2011/20110714/">Read more <span aria-hidden="true">&raquo;</span></a></li>
    </ul>
  </footer>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110713/">linuxでプリンタ設定</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-07-13T16:52:57&#43;09:00">
          Jul 13, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    linuxサーバ上でJasperReportを使ってPDFファイルを生成し、プリンタに直接印刷する必要が生じたので、環境を作りました。サーバはubuntuの64bit、プリンタはキャノンLBP8620。
キャノンのサイトを見てみると、linux 64bit用のドライバはrpmでしか提供されていないようす。ubuntuにはrpmコマンドがないので、どうしたものかと調べて、alienコマンドを使うことにしました。まずはalienのインストール。
$ sudo apt-get install alien キャノンのサイトからダウンロードしたドライバのインストール。
$ sudo alien -i cndrvcups-common_2.20-1.x86_64.rpm $ sudo alien -i cndrvcups-lips4-2.20-1.x86_64.rpm ここでcupsのリスタート。
$ sudo /etc/init.d/cups restart プリンタの定義。ppdファイル名はキャノンのサイトを参照しました。
$ sudo lpadmin -p cop -m CNCUPSLBPSERIESLJ.ppd -v lpd://cop.is.magazine.co.jp/cop -E これで、
$ lpr -P cop XXXXXXXX.pdf などでlinuxからpdfの印刷ができるようになりましたが、フォントの設定ができてなくて、中途半端に文字化けします。このあたりはひきつづき調査。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110707/">USB3.0 HDD</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-07-07T17:00:56&#43;09:00">
          Jul 7, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    バックアップ用にUSB3.0の外付けHDDを2本購入。さっそくlinuxにつないで試してみる。4Gのファイルをコピーしてみたら、結果としてはちょっと困った感じになった。
USB3.0外付けその1　2分10秒
USB3.0外付けその2　1分20秒
内蔵HDD　20秒
内蔵SDD　11秒
外付けUSBは時間がかかりすぎではないだろうか。おなじUSB3.0でも2本のHDDで1分以上差がつくのも解せない。ためしに、別のlinuxマシンにつないで運用しているUSB2.0のHDDで同様のことをしたら、2分10秒くらいで、USB3.0外付けその1とほぼ同タイム。どういうことなんだろう。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110630/">scalaスクリプトでおかしな挙動？</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-30T17:03:13&#43;09:00">
          Jun 30, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    たとえば、
object Foo { val ZOO = &quot;xxxx&quot; } というクラスを作ってコンパイルします。これをスクリプトの中で使います。
println(Foo.ZOO) これはOK。次に、
object Foo { val ZOO = &quot;xxxx&quot; val ZOO_ADDED = &quot;ZZZZZ&quot; } と、ZOO_ADDEDを増やします。そして、これをスクリプト中で使います。すると、
script.scala:2: error: value ZOO_ADDED is not a member of object Foo println(Foo.ZOO_ADDED) ^ one error found と、エラーになってしまいます。同じことをREPLでやるとこちらはエラーになりません。すごく不思議なんですが、scalaのテンポラリディレクトリ（/tmp/scala-devel）を一度削除するとスクリプトも動くようになります。ちょっと気持ちの悪い挙動でした。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110629/">macでemacs</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-29T17:05:48&#43;09:00">
          Jun 29, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    一方macではどうかと、macのcocoa emacsに環境設定。こちらのほうは素直になにもかも動いた。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110629-2/">windowsでemacs</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-29T15:06:33&#43;09:00">
          Jun 29, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    今までは、windows用のXサーバを使って、リモートのlinuxのemacsをwindows上で開いて使っていたが、どうも最近よく落ちる。そこで、windows上で動くemacsを試してみた。emacsを使うには
 日本語入出力 trampでリモートファイル編集 sshでファイル名補完  ができるのが大前提。ざっと調べてgnupackを入れてみた。日本語は問題なし。
trampはdefault methodをpscpにして正常動作を確認。ところが、開けるファイルと開けないファイルがある。開けないときは
File exists, but cannot be read というメッセージ。開けるファイルと見比べても違いがわからず、小1時間。結局ファイルサイズに上限があるようで、tramp copy size limitをデフォルトの10240から10240000に変更。これをnilにすると上限なしになるみたいだけど、効かなかった。
sshは、リモートホストにアクセスすると、
Pseudo-terminal will not be allocated because stdin is not a terminal. というメッセージが出る。プロンプトは表示されないが、lsなどが効く。しかしこれでは気持ち悪いのでいろいろやったら、どうも2回目のアクセスは正常に動く。1回目だけを犠牲にすればいいだけだから、まあいいか。裏でtrampが走ってファイル名補完も動作。しかし、sshするときに、いまアクティブになっているバッファが影響するようで、ssh-taro@hogeのバッファがアクティブな状態でhanako@booにアクセスしようとすると、taro@booのパスワードを要求されたりする。この辺はちょっと問題。ほかには
trampの最初のアクセスで補完が効かない 設定ファイルがgnupack-xxxx/{config.ini, home/.emacs}とかにあって、別の場所に移したい
など
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110628/">java, scalaでOSコマンド実行</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-28T17:08:45&#43;09:00">
          Jun 28, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    Runtime	rt = Runtime.getRuntime(); Process p = rt.exec(&quot;cp -p foo.txt foo.txt.BACKUP&quot;); p.waitFor(); など。|や&gt;を使いたいときは、
String cmd = &quot;diff foo.txt foo.txt.BACKUP &gt; foo.txt.diff&quot;; String[] cmdArray = {&quot;/bin/sh&quot;, &quot;-c&quot;, cmd}; Runtime	rt = Runtime.getRuntime(); Process p = rt.exec(cmdArray); というぐあいにArrayにする。
ちなみにscalaだとこんな感じ。
val cmdBody = &quot;diff foo.txt foo.txt.BACKUP &gt; foo.txt.diff&quot; val cmd = Array(&quot;su&quot;, &quot;-&quot;, &quot;nobody&quot;, &quot;-c&quot;, cmdBody) val p = Process(cmd).run if (p.exitValue != 0) { p.toString() println(&quot;異常終了 &quot; + p.toString()) } 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110623/">scalaでスクリプトを書く</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-23T17:09:45&#43;09:00">
          Jun 23, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    perlとかで書いていたスクリプトをscalaで書こうとすると、クラスパスなどの環境変数を定義してからscalaスクリプトを起動するような起動ファイルが別にいるんだと、昔のCOBOLとJCLみたいでかっこわるいなと思っていたら、解決することができた。scalaスクリプト冒頭に
#! /bin/bash cp=&quot;/usr/local/share/commons-logging.jar&quot; export JAVA_OPTS=&quot;-server -Xms1024m -Dcluster=localhost:1100&quot; exec scala -classpath $cp $0 $@ !# println(&quot;Hello, Scala!&quot;) とするとひとつのファイルで環境設定とscalaスクリプトの実行ができる。また、外部からの引数はargs:Array[String]に入って渡ってくるので、そのまま使えばＯＫ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110620/">ubuntuのcron環境</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-20T17:10:48&#43;09:00">
          Jun 20, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    今までRedHatで動いていたcronのジョブをubuntuに移植したところ、sourceコマンドがない、というエラーが出るようになった。なぜかubuntuのcronはbashではなく、shで動いているもよう。crontab -eでcronの編集画面を開いて、
SHELL=/bin/bash を加えるとbashで動くようになった。
さらに、cronから出るメールが文字化け。ヘッダをみると、
Content-type: text/plain; charset=ANSI_X3.4-1968 となっていたので、上記のようにcrontab -eで
CONTENT_TYPE=text/plain; utf-8 を追加して解決。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110609/">ubuntuのインストール</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-09T17:11:47&#43;09:00">
          Jun 9, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    ひさしぶりのlinuxインストール。マシンはSSDを搭載しているので、SSDにインストールしたところ、最後にgrubの書き込みに失敗とのメッセージ。windowsに戻してデュアルブートにしたり、super grub diskを使ってみたり、いろいろしましたが、インストール時にブートローダのインストール場所を指定するところで、/dev/sdaとしていたのがいけなかったようで。/dev/mapper/xxxxx (striped)を指定したらすっと入りました。SSDだからとかは関係なかった。そのほか気がついたこと。
64bitインストーラは日本のサイトでは見つけられなかった。ubuntu.comからダウンロード。ファイル名にamdとあるが気にしない
当然のことながらCDに焼くよりusbメモリのほうが速い。インストールも速い。
usbにインストーラを入れるときはnetbootinというツールを使用
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110608/">portからbrewへ</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-08T17:12:31&#43;09:00">
          Jun 8, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    MacBook Airでportを使っていましたが、scala29をインストールするとエラーが発生。ライブラリがないとかいってきましたが、これを機会にbrewに乗り換えました。
$ cd /usr $ sudo mkdir local $ sudo chown xxxx local $ cd local $ ruby -e &quot;$(curl -fsSL https://raw.github.com/gist/323731/39fc1416e34b9f6db201b4a026181f4ceb7cfa74)&quot; で、brew install scala, brew install sbtなど。インストールすると、/usr/local/Cellarというディレクトリにもろもろ入るようです。
あとは、~/.bash_profileで/usr/local/binへのパスを張っときます。これで、play + scala環境がMacにできたと。やっぱり手元がunixだとなにかと便利、な気がします。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110607/">play &#43; scala</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-06-07T17:13:19&#43;09:00">
          Jun 7, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    playにscalaをインストールする
$ play install scala プロジェクトを作る
$ play new sampleappscala --with scala 実行
$ play run sampleappscala 
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110422/">scala &#43; google app engineでのエラー回避</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-04-22T17:14:16&#43;09:00">
          Apr 22, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    eclipseでscalaを使ってgoogle app engineのプロジェクトを作りビルドすると
scala org.datanucleus.metadata.MetaDataManager loadClasses 的なエラーが出る。これを回避するには.projectのdatanucleusあたりをコメントアウト。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2011/20110420/">eclipseでandroid&#43;scalaプロジェクトを作る手順</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2011-04-20T17:15:16&#43;09:00">
          Apr 20, 2011
        </time>
      </div>
    </div>
  </header>
  <div>
    ./create_project crashball org.crashball --platform android-7 --scala-version 2.8.1 でプロジェクトを作成。
eclipseでプロジェクトを作成。こちらはscalaプロジェクト。
create_projectで作ったディレクトリからproject, src/*, testsをeclipseプロジェクトへ移動。
sbt update eclipseでソースフォルダの設定
src/main/java src/main/scala src/test/scala クラスパスの設定。android-sdkから適当なバージョンのandroid.jarを追加。プロジェクト内のlib_managed/scala_2.8.1/test/scalatest-1.2.jarも追加。
これでできあがり。あとはsbtでcompileなり、start-emulator, start-deviceなり。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2010/20100830/">映画『バレンタインデー』</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2010-08-30T17:16:29&#43;09:00">
          Aug 30, 2010
        </time>
      </div>
    </div>
  </header>
  <div>
    ITには関係ないけれど、休日のリフレッシュのために映画「バレンタインデー」を観ました。いろいろ詰め込み過ぎなのか、ユーモアの部分とシリアスの部分の振れ幅が小さいなど、編集がちょっと甘かったりしましたが、そこそこおもしろかったです。似たような作品では「ラブ・アクチュアリー」のほうが出来は上だったかな。中にはいいセリフもありました。「愛するということは、相手の好きなところ、いいところを愛するだけでなく、悪いところ、嫌なところも丸ごと愛するということだ」みたいなことをシャーリー・マクレーンがいっていました。いかんせん、このシーンの彼女の衣装がなんかフワフワしてて、いいセリフがずしーんとこないんですよねえ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2010/20100729/">scalaでJavaのインナークラスを扱う</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2010-07-29T17:19:06&#43;09:00">
          Jul 29, 2010
        </time>
      </div>
    </div>
  </header>
  <div>
    scalaでJavaのインナークラスを使う場面に、apache pivotをさわっているとき出くわしました。
import org.apache.pivot.wtk.Component して
var style:Component#StyleDictionary = label.getStyles() とする。#を使うんですねえ。
  </div>
  
</article>

  
  <hr/>
  <article>
  <header>
    <h2><a href="https://ymraintree.github.io/blog/post/2010/20100720/">scala-2.8でEJB</a></h2>
    <div class="post-meta clearfix">
      <div class="post-date pull-left">
        Posted on
        <time datetime="2010-07-20T17:20:04&#43;09:00">
          Jul 20, 2010
        </time>
      </div>
    </div>
  </header>
  <div>
    scala-2.8が先週リリースされたので、eclipseプラグインもアップデートしてみました。既存のEJBが
@GeneratedValue(strategy=GenerationType.AUTO) の行でannotation needs to be a constantというメッセージでエラーになりました。
コマンドラインでscalacするとコンパイルできるようなので、eclipseプラグインの問題のようです。移行はもうちょっと待ってみよう。
  </div>
  
</article>

  
</section>
  </main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
      
    </div>
    <div class="sns-links hidden-print">
  
  
  
  
  
  
  
  
  
  
  
  
</div>

  </footer>

  <script src="https://ymraintree.github.io/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  
</body>
</html>


